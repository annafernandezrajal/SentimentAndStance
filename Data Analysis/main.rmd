##Testing R

load data
```{r}
# data <- read.csv("Data Analysis/dataset/output.csv")

data <- read.csv("C:/Users/steem/Desktop/StudiesKTH/II2202 Research Methodology and Scientific Writing/SentimentAndStance/Data Analysis/dataset/output.csv")

data
```

Pre-process
```{r}
stance <- data$Stance
sentiment <- data$Sentiment
predicted_sentiment <- data$sentimentVader

stance <- replace(stance, stance=="FAVOR", 1)
stance <- replace(stance, stance=="NONE", 0)
stance <- replace(stance, stance=="AGAINST", -1)
stance <- as.numeric(stance)

sentiment <- replace(sentiment, sentiment=="neg", -1)
sentiment <- replace(sentiment, sentiment=="other", 0)
sentiment <- replace(sentiment, sentiment=="pos", 1)
sentiment <- as.numeric(sentiment)

predicted_sentiment <- replace(predicted_sentiment, predicted_sentiment<0, -1)
predicted_sentiment <- replace(predicted_sentiment, predicted_sentiment>0, 1)
predicted_sentiment <- as.numeric(predicted_sentiment)

data$Stance <- stance
data$Sentiment <- sentiment
data$sentimentVader <- predicted_sentiment
```

TESTING VISUALIZATION
```{r}
library(gplots)
sentimentHeatmapData <- data.frame(data$Sentiment, data$sentimentVader)
sentimentHeatmapData <- table(sentimentHeatmapData)
sentimentHeatmapData

# save heatmap as image
# png("Data Analysis/images/VaderGroundTruthHeatmap.png",
#   width = 1500,
#   height = 1500,
#   res = 300,
#   pointsize = 8)
png("C:/Users/steem/Desktop/StudiesKTH/II2202 Research Methodology and Scientific Writing/SentimentAndStance/Data Analysis/images/VaderGroundTruthHeatmap.png",
    width = 1500,
    height = 1500,
    res = 300,
    pointsize = 8)


#Note that I'm using a dark theme, so the colors might be inverted
library(pals)

lmat = rbind(c(0,3),c(2,1),c(0,4))
lwid = c(0.5,4)
lhei = c(1.5,4, 1.5)
rownames(sentimentHeatmapData) <- c("negative", "neutral", "positive")
colnames(sentimentHeatmapData) <- c("negative", "neutral", "positive")
heatmap.2(sentimentHeatmapData,
          scale = "none",
          cellnote=sentimentHeatmapData,
          main="Vader and ground-truth sentiment",
          density.info = "none",
          trace="none",
          notecol="white",
          dendrogram='none',
          Colv = FALSE,
          Rowv = FALSE,
          col=ocean.curl,
          margins=c(12,12),
          lmat=lmat,
          lwid=lwid,
          lhei=lhei,
          cexRow=1,
          cexCol=1,
          xlab="Vader",
          ylab="True value")

dev.off()
```


EXPERIMENTS

Experiment 1) How does sentiment analysis perform compared to the ground-truth?
```{r}
cat(sum(sentiment == predicted_sentiment) / length(sentiment), "% accuracy", sep='')
```

Experiment 2) How does stance detection perform compared to the ground-truth?

Experiment 3) How much overlap is there between ground-truth sentiment and stance?
```{r}
cat(sum(stance == sentiment) / length(stance), "% overlap", sep='')
```

Experiment 4) How much overlap is there between sentiment and stance?

Experiment 5) How do values for sentiment map to values for stance (with bucket sizes of 0.2)?





```{r}
library(yardstick)
library(ggplot2)

set.seed(123)
truth_predicted <- data.frame(
  obs <- data$Sentiment,
  pred <- data$sentimentVader
)

# truth_predicted <- data.frame(
#   obs = sample(-1:1,100, replace = T),
#   pred = sample(-1:1,100, replace = T)
# )

truth_predicted$obs <- as.factor(truth_predicted$obs)
truth_predicted$pred <- as.factor(truth_predicted$pred)

# The confusion matrix from a single assessment set (i.e. fold)
cm <- conf_mat(truth_predicted, obs, pred)

autoplot(cm, type = "heatmap") +
        scale_fill_gradient(low="#D6EAF8",high = "#2E86C1") + theme(legend.position = "right")

```
